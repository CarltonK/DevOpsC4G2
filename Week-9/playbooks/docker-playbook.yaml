- name: Install Docker
  hosts: all
  tasks:
    - name: Update the cache
      apt:
        update_cache: yes
        upgrade: yes

    - name: Install packages
      apt:
        name:
          - apt-transport-https
          - ca-certificates
          - curl
          - software-properties-common
          - python3-pip
          - virtualenv
          - python3-setuptools
        update_cache: yes

    - name: Add Docker official GPG key
      apt_key:
        url: https://download.docker.com/linux/debian/gpg
        state: present

    - name: Add docker repository
      apt_repository:
        repo: https://download.docker.com/linux/debian bionic stable
        state: present

    - name: Update the cache
      apt:
        update_cache: yes

    - name: Install packages
      apt:
        name:
          - docker-ce 
          - docker-ce-cli 
          - containerd.io 
          - docker-buildx-plugin 
          - docker-compose-plugin
        update_cache: yes

    - name: Install the Docker module for Python, required by ansible
      pip:
        name: docker

    # - name: Pull the official Debian image using the container_image variable. This image will be used in next step.
    #   docker_image:
    #     name: "{{ container_image }}"
    #     source: pull

    # - name: Creates 3 containers, using the variables we defined in the vars file
    #   docker_container:
    #     name: "{{ container_name }}{{ item }}"
    #     image: "{{ container_image }}"
    #     command: "{{ command_to_run }}"
    #     state: present
    #   with_sequence: count={{ no_containers }}
